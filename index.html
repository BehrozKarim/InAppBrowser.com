<head>
    <meta name="viewport" content="user-scalable=no, width=device-width">
    <meta charset="utf-8">
    <title>inAppBrowser.com</title>
    <script defer data-domain="inappbrowser.com" src="https://plausible.io/js/plausible.js"></script>
</head>
<h1>inAppBrowser.com</h1>
<p id="author">via <a target="_blank" href="https://twitter.com/KrauseFx">@KrauseFx</a></p>
<p>Verify the app's in-app browser is not injecting any JavaScript code</p>
<p>For full context, please <a target="_blank" href="https://krausefx.com/blog/ios-privacy-instagram-and-facebook-can-track-anything-you-do-on-any-website-in-their-in-app-browser">read
    this first</a>.</p>

<div class="summaries" id="clean-summary">
    ‚úÖ &nbsp;Good news, it looks like the host app doesn't inject any JavaScript code.
</div>
<div class="summaries" id="medium-summary">
    üïµÔ∏è‚Äç‚ôÇÔ∏è &nbsp;JavaScript injection detected! See the list of commands above! This does not mean anything malicious is happening.
</div>
<div class="summaries" id="dangerous-summary">
    üö® &nbsp;JavaScript injection detected! Including some potentially malicious or dangerous commands. See the highlights above!
</div>
<ul id="all-comments">
</ul>

The above is a summary of the commands this page has detected. This page can't detect all commands, so there might be other tracking happening not shown here. Also, the above only shows the commands that we also interpret, for a full list of all commands,
check out the list below, however it will require engineering skills to understand what is happening.

<ol id="resultsList">
    <h3>Detected JavaScript Commands:</h3>
    <p id="none">None</p>
</ol>

<footer>
    <hr />
    <p>
        <b>Important:</b> The above list of commands might not be the full list. This page works by overriding the most common JavaScript functions. The host app might still inject other commands. Also, this page can only monitor JS commands, and can't
        detect other tracking the app might do, like adding custom gesture recognisers on top of the webview, screenshot detections, or subscribing to web request events of the web view. The list of potentially dangerous JS commands is incomple, and was
        built based on analysing some of the most popular iOS apps. All the notes added might not be 100% accurate and are only there to help understand the typical context of a given command.
    </p>
    <br />
    <p>For full details on what this website does <a target="_blank" href="https://krausefx.com/blog/ios-privacy-instagram-and-facebook-can-track-anything-you-do-on-any-website-in-their-in-app-browser">read
      this article first</a>.</p>
    <p>For more privacy & security projects visit <a target="_blank" href="https://krausefx.com/privacy">krausefx.com/privacy</a>.</p>
</footer>

<script type="text/javascript">
    // Fetch the nodes first, before we override the `document` methods
    const resultsList = document.getElementById("resultsList")
    const noneElement = document.getElementById("none")
    const cleanSummary = document.getElementById("clean-summary")
    const mediumSummary = document.getElementById("medium-summary")
    const dangerousSummary = document.getElementById("dangerous-summary")
    const allComments = document.getElementById("all-comments")
    const summary = document.getElementById("summary")
    const denyList = [
        "globalThis",
        "Object",
        "log",
        "parseInt",
        "Array",
        "Promise",
        "Reflect",
        "location",
        "onmouseout",
        "onmouseover",
        "onpointerout",
        "onmousemove",
        "onmouseleave",
        "onpointerrawupdate",
        "onpointerover",
        "onpointerenter",
        "onpointermove",
        "onmouseenter",
        "onpointerleave",
        "onscroll",
        "onpointerdown",
        "ongotpointercapture",
        "onpointercancel",
        "onlostpointercapture",
        "defaultView"
    ]

    const potentiallyDangerous = {
        "createElement('script')": "Injects external JavaScript code",
        "http://": "Uses an unencrypted URL, making the whole page insecure",
        "selectionchange": "Used to monitor text selections",
    }
    const neutralNotes = {
        "querySelector('input[type=password]": "Accessing all password fields: This could either mean the app has a password manager, or the app reads or enters passwords on the website"
    }
    const goodNotes = {
        "querySelector('head > meta[property=\"og:site_name\"]')": "Gets the website's name",
        "querySelector('head > meta[name=\"title\"]')": "Gets the website title",
        "querySelectorAll('head > link[rel~=\"icon\"]')": "Gets the website's favicon(s)",
        "getElementsByTagName('meta')": "Gets the page's metadata (like share text), this is unrelated to Meta the company",
    }

    let lastLevel = -1;

    function appendEvent(str, level) {
        noneElement.style.display = "none"
        let classesToUse = ""
        let comments = ""

        // Iterate over potentiallyDangerous, and see if any of them are included in the `str`
        for (const [key, value] of Object.entries(potentiallyDangerous)) {
            if (str.indexOf(key) > -1) {
                classesToUse += "danger"
                comments += `<p class='bad-comment'>^&nbsp;&nbsp;${value}</p>`
                allComments.innerHTML += `<li class='bad-in-comments'>${value}</li>`

                cleanSummary.style.display = "none"
                mediumSummary.style.display = "none"
                dangerousSummary.style.display = "block"
            }
        }
        // Iterate over neutralNotes, and see if any of them are included in the `str`
        for (const [key, value] of Object.entries(neutralNotes)) {
            if (str.indexOf(key) > -1) {
                classesToUse += "neutral"
                comments += `<p class='neutral-comment'>^&nbsp;&nbsp;${value}</p>`
                allComments.innerHTML += `<li class='neutral-in-comments'>${value}</li>`
            }
        }
        // Iterate over goodNotes, and see if any of them are included in the `str`
        for (const [key, value] of Object.entries(goodNotes)) {
            if (str.indexOf(key) > -1) {
                comments += `<p class='good-comment'>^&nbsp;&nbsp;${value}</p>`
                allComments.innerHTML += `<li class='good-in-comments'>${value}</li>`
            }
        }

        if (level < lastLevel) {
            classesToUse += "reducedLevel"
        }
        lastLevel = level;

        resultsList.innerHTML += "<li class='" + classesToUse + "'>" + str + comments + "</li>"
        if (cleanSummary.style.display !== "none") {
            cleanSummary.style.display = "none"
            mediumSummary.style.display = "block"
        }
    }

    // Function to help surround the value by ' if it's a string
    function renderParam(param) {
        if (typeof param === "string") {
            return "'" + param.replace("'", "\\'") + "'"
        } else {
            return param
        }
    }

    function overrideFunction(node, prop, level) {
        if (typeof node[prop] !== "function") {
            return;
        }
        try {
            const original = node[prop]
            node[prop] = function() {
                let str = prop;
                if (arguments) {
                    str = `${node.constructor.name}.${prop}(`
                    str += Object.values(arguments).map((arg) => renderParam(arg)).join(", ")
                    str += ")"
                }
                // `str` would be something like
                // "HTMLDocument.querySelector('head > meta['property="og:site_name"]')"

                appendEvent(str, level)
                const fakeObj = original.apply(node, arguments)
                if (fakeObj) {
                    investigate(fakeObj, level + 1);
                    const handler1 = {
                        get(target, prop, receiver) {
                            // For some reason, prop is always a string it seems
                            const spaces = "&nbsp;".repeat(level * 4)
                            if (Math.abs(parseInt(prop)) > 0 || prop == "0") {
                                appendEvent(spaces + fakeObj + "[" + renderParam(prop) + "]", level + 1)
                            } else {
                                appendEvent(spaces + fakeObj + "." + prop + "", level + 1)
                            }
                            return target[prop]
                        },
                        set(target, prop, value, receiver) {
                            const spaces = "&nbsp;".repeat(level * 4)
                            if (Math.abs(parseInt(prop)) > 0 || prop == "0") {
                                appendEvent(spaces + fakeObj + "[" + renderParam(prop) + "] = '" + value + "'", level + 1)
                            } else {
                                appendEvent(spaces + fakeObj + "." + prop + " = " + renderParam(value), level + 1)
                            }
                            return target[prop] = value
                        }
                    }

                    return new Proxy(fakeObj, handler1);
                }
                return fakeObj;
            }
            console.log("Sucessfully overwrote " + prop + " on " + node)
        } catch (e) {
            console.error(e);
        }
    }

    function investigate(node, level) {
        for (var prop in node) {
            if (denyList.includes(prop)) {
                continue;
            }
            value = node[prop]
            overrideFunction(node, prop, level)
        }
    }
    investigate(document, 1);
</script>

<style type="text/css">
    * {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        color: #353535;
    }
    
    .bad-comment {
        font-size: 0.8em;
        color: rgb(175, 0, 0);
        text-align: right;
        margin-bottom: 5px;
        width: 100%;
        margin-top: 0px;
        font-family: 'Courier New', Courier, monospace;
        padding: 5px;
    }
    
    .neutral-comment {
        font-size: 0.8em;
        color: rgb(0, 0, 175);
        text-align: right;
        margin-bottom: 5px;
        font-weight: bold;
        width: 100%;
        margin-top: 0px;
        font-family: 'Courier New', Courier, monospace;
        padding: 5px;
    }
    
    .good-comment {
        font-size: 0.8em;
        color: rgb(0, 187, 0);
        text-align: right;
        margin-bottom: 5px;
        width: 100%;
        font-weight: bold;
        margin-top: 0px;
        font-family: 'Courier New', Courier, monospace;
        padding: 5px;
    }
    
    .reducedLevel {
        margin-top: 30px;
    }
    
    body {
        background-color: #f0f0f0;
        max-width: 600px;
    }
    /* On larger screens only */
    
    @media only screen and (min-width: 600px) {
        body {
            margin: 40px;
        }
    }
    
    h1 {
        font-size: 1.5em;
    }
    
    ol {
        border: 1px solid #ccc;
        padding-left: 10px;
        padding-right: 35px;
        padding-top: 0px;
        padding-bottom: 10px;
        list-style: none;
    }
    
    a {
        color: #0085bd !important;
    }
    
    #resultsList h3 {
        margin-top: 10px;
        padding-top: 0px;
    }
    
    #resultsList {
        margin-left: -5px;
        margin-right: -5px;
        overflow-y: auto;
        max-width: cacl(100% - 10px);
        white-space: nowrap;
    }
    
    ol>li {
        margin-bottom: 0.5em;
        font-size: 0.8em;
        font-family: monospace;
    }
    
    #author {
        margin-top: -10px;
    }
    
    footer a {
        text-decoration: none;
    }
    
    footer p {
        margin-top: 0px;
        margin-bottom: 5px;
    }
    
    .danger {
        color: rgba(255, 0, 0, 1);
        font-weight: bold;
    }
    
    hr {
        border: 0;
        height: 1px;
        margin-top: 25px;
        margin-bottom: 25px;
        background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(40, 40, 40, 0.3), rgba(0, 0, 0, 0));
        background-color: transparent !important;
    }
    
    .summaries {
        padding: 20px;
        margin-left: -5px;
        margin-right: -5px;
    }
    
    #clean-summary {
        background-color: rgba(0, 255, 0, 0.2)
    }
    
    #medium-summary {
        display: none;
        background-color: rgba(255, 255, 0, 0.3);
    }
    
    #dangerous-summary {
        display: none;
        background-color: rgba(255, 0, 0, 0.3);
    }
    
    #all-comments {
        padding-left: 10px;
        margin-top: -0px;
        border: 3px solid #ccc;
        border-top: none;
        list-style: inside;
        line-height: 1.8;
    }
    
    #all-comments>.in-comments {
        text-align: left !important;
        padding-left: 0px;
    }
</style>