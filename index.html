<head>
    <meta name="viewport" content="user-scalable=no, width=device-width">
    <meta charset="utf-8">
    <title>inAppBrowser.com</title>
    <script defer data-domain="inappbrowser.com" src="https://plausible.io/js/plausible.js"></script>
</head>
<h1>InAppBrowser.com</h1>
<p class="subtitle">Verify if an app's in-app browser is injecting JavaScript code</p>
<p id="high-level-summary">
    Some iOS and Android apps make use of a custom in-app browser (<a target="_blank" href="https://krausefx.com/blog/ios-privacy-instagram-and-facebook-can-track-anything-you-do-on-any-website-in-their-in-app-browser">full details</a>). This causes potential
    security and privacy risks to the user. This page is designed to help you see what the in-app browser is doing.
</p>

<div class="summaries" id="clean-summary">
    ‚úÖ &nbsp;Good news, it looks like the host app doesn't inject any JavaScript code.
</div>
<div class="summaries" id="medium-summary">
    üïµÔ∏è‚Äç‚ôÇÔ∏è &nbsp;Javascript injection detected. This does not necessarily imply malicious behaviour.
</div>
<div class="summaries" id="dangerous-summary">
    üö® &nbsp;JavaScript injection detected, with some potentially dangerous commands.
</div>
<ul id="all-comments">
</ul>
<hr style="margin-top: 0px; margin-bottom: 15px" />

<div class="summary-note" id="top-summary-1">
    The summary above is a list of things detected from this in-app browser. However, it is not a comprehensive list and the raw output below should be carefully studied to understand what is happening.
</div>

<ol id="resultsList">
    <h5>Detected JavaScript Commands:</h5>
</ol>

<div class="summary-note">
    <b>Disclaimer</b>: This tool works by overriding the most common JavaScript functions, however the host app may still inject other commands. This tool cannot detect other app tracking that may occur, such as custom gesture recognition, screenshot
    detection, or tracking of web request events. It is important to diagnose the raw output, and have context of the product, to understand how the app is using this data.
</div>

<footer>
    <hr />
    <p>
        <a target="_blank" href="https://krausefx.com/blog/ios-privacy-instagram-and-facebook-can-track-anything-you-do-on-any-website-in-their-in-app-browser">
            About this tool
        </a> |
        <a target="_blank" href="https://krausefx.com/privacy">
            Additional privacy projects
        </a> | <a target="_blank" href="https://twitter.com/KrauseFx">@KrauseFx</a></p>
</footer>

<script type="text/javascript">
    // Fetch the nodes first, before we override the `document` methods
    const resultsList = document.getElementById("resultsList")
    const cleanSummary = document.getElementById("clean-summary")
    const elementsToHideOnNonClean = [
        cleanSummary,
    ]
    const elementsToShowOnNonClean = [
        resultsList,
        document.getElementById("top-summary-1"),
    ]
    for (const element of elementsToShowOnNonClean) {
        element.style.display = "none"
    }
    const mediumSummary = document.getElementById("medium-summary")
    const dangerousSummary = document.getElementById("dangerous-summary")
    const allComments = document.getElementById("all-comments")
    const summary = document.getElementById("summary")
    const denyList = [
        "globalThis",
        "Object",
        "log",
        "parseInt",
        "Array",
        "Promise",
        "Reflect",
        "location",
        "onmouseout",
        "onmouseover",
        "onpointerout",
        "onmousemove",
        "onmouseleave",
        "onpointerrawupdate",
        "onpointerover",
        "onpointerenter",
        "onpointermove",
        "onmouseenter",
        "onpointerleave",
        "onscroll",
        "onpointerdown",
        "ongotpointercapture",
        "onpointercancel",
        "onlostpointercapture",
        "defaultView",
        "toString"
    ]

    const potentiallyDangerous = {
        "createElement('script'": "Injects external JavaScript code",
        "http://": "Uses an unencrypted URL, making the whole page insecure",
        "addEventListener('selectionchange'": "Monitors all text selections on websites",
        "addEventListener('click'": "Monitors all taps happening on websites",
        "addEventListener('keypress'": "Monitors all keyboard inputs on websites",
        "createElement('a'": "Creates a new link on website"
    }
    const neutralNotes = {
        "querySelector('input[type=password]": "Accessing all password fields: This could either mean the app has a password manager, or the app reads or enters passwords on the website",
        "createElement('style')": "Add CSS code, allows app to customize appearance of website",
    }
    const goodNotes = {
        "querySelector('head > meta[property=\"og:site_name\"]')": "Gets the website's name",
        "querySelector('head > meta[name=\"title\"]')": "Gets the website title",
        "querySelectorAll('head > link[rel~=\"icon\"]')": "Gets the website's favicon(s)",
        "querySelector('head > title')": "Gets the website title",
        "getElementsByTagName('meta')": "Gets the page's metadata (like share text), this is unrelated to Meta the company",
    }

    let lastLevel = -1;

    function appendEvent(str, level) {
        let classesToUse = ""
        let comments = ""

        // Iterate over potentiallyDangerous, and see if any of them are included in the `str`
        for (const [key, value] of Object.entries(potentiallyDangerous)) {
            if (str.indexOf(key) > -1) {
                classesToUse += "danger"
                comments += `<p class='bad-comment'>^&nbsp;&nbsp;${value}</p>`
                allComments.innerHTML += `<li class='bad-in-comments'>${value}</li>`

                cleanSummary.style.display = "none"
                mediumSummary.style.display = "none"
                dangerousSummary.style.display = "block"
            }
        }
        // Iterate over neutralNotes, and see if any of them are included in the `str`
        for (const [key, value] of Object.entries(neutralNotes)) {
            if (str.indexOf(key) > -1) {
                comments += `<p class='neutral-comment'>^&nbsp;&nbsp;${value}</p>`
                allComments.innerHTML += `<li class='neutral-in-comments'>${value}</li>`
            }
        }
        // Iterate over goodNotes, and see if any of them are included in the `str`
        for (const [key, value] of Object.entries(goodNotes)) {
            if (str.indexOf(key) > -1) {
                comments += `<p class='good-comment'>^&nbsp;&nbsp;${value}</p>`
                allComments.innerHTML += `<li class='good-in-comments'>${value}</li>`
            }
        }

        if (level < lastLevel) {
            classesToUse += "reducedLevel"
        }
        lastLevel = level;

        resultsList.innerHTML += "<li class='" + classesToUse + "'>" + str + comments + "</li>"
        for (const element of elementsToShowOnNonClean) {
            element.style.display = "block"
        }

        if (cleanSummary.style.display !== "none") {
            for (const element of elementsToHideOnNonClean) {
                element.style.display = "none"
            }
            mediumSummary.style.display = "block"
        }
    }

    // Function to help surround the value by ' if it's a string
    function renderParam(param) {
        if (typeof param === "string") {
            return "'" + param.replace("'", "\\'") + "'"
        } else {
            return param
        }
    }

    function overrideFunction(node, prop, level) {
        if (typeof node[prop] !== "function") {
            return;
        }
        try {
            const original = node[prop]
            node[prop] = function() {
                let str = prop;
                if (arguments) {
                    str = `${node.constructor.name}.${prop}(`
                    str += Object.values(arguments).map((arg) => renderParam(arg)).join(", ")
                    str += ")"
                }
                // `str` would be something like
                // "HTMLDocument.querySelector('head > meta['property="og:site_name"]')"

                appendEvent(str, level)
                const fakeObj = original.apply(node, arguments)
                if (fakeObj) {
                    investigate(fakeObj, level + 1);
                    const handler1 = {
                        get(target, prop, receiver) {
                            // For some reason, prop is always a string it seems
                            const spaces = "&nbsp;".repeat(level * 4)
                            if (Math.abs(parseInt(prop)) > 0 || prop == "0") {
                                appendEvent(spaces + fakeObj + "[" + renderParam(prop) + "]", level + 1)
                            } else {
                                appendEvent(spaces + fakeObj + "." + prop + "", level + 1)
                            }
                            return target[prop]
                        },
                        set(target, prop, value, receiver) {
                            const spaces = "&nbsp;".repeat(level * 4)
                            if (Math.abs(parseInt(prop)) > 0 || prop == "0") {
                                appendEvent(spaces + fakeObj + "[" + renderParam(prop) + "] = '" + value + "'", level + 1)
                            } else {
                                appendEvent(spaces + fakeObj + "." + prop + " = " + renderParam(value), level + 1)
                            }
                            return target[prop] = value
                        }
                    }

                    return new Proxy(fakeObj, handler1);
                }
                return fakeObj;
            }
            console.log("Sucessfully overwrote " + prop + " on " + node)
        } catch (e) {
            console.error(e);
        }
    }

    function investigate(node, level) {
        for (var prop in node) {
            if (denyList.includes(prop)) {
                continue;
            }
            value = node[prop]
            overrideFunction(node, prop, level)
        }
    }
    investigate(document, 1);
</script>

<style type="text/css">
    * {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        color: #353535;
    }
    
    .bad-comment {
        font-size: 0.8em;
        color: rgb(175, 0, 0);
        text-align: right;
        margin-bottom: 5px;
        width: 100%;
        margin-top: 0px;
        font-family: 'Courier New', Courier, monospace;
        padding: 5px;
    }
    
    .neutral-comment {
        font-size: 0.8em;
        color: rgb(0, 0, 175);
        text-align: right;
        margin-bottom: 5px;
        font-weight: bold;
        width: 100%;
        margin-top: 0px;
        font-family: 'Courier New', Courier, monospace;
        padding: 5px;
    }
    
    .good-comment {
        font-size: 0.8em;
        color: rgb(0, 187, 0);
        text-align: right;
        margin-bottom: 5px;
        width: 100%;
        font-weight: bold;
        margin-top: 0px;
        font-family: 'Courier New', Courier, monospace;
        padding: 5px;
    }
    
    .reducedLevel {
        margin-top: 30px;
    }
    
    body {
        background-color: #f0f0f0;
        max-width: 600px;
        padding-bottom: 20px;
    }
    /* On larger screens only */
    
    @media only screen and (min-width: 600px) {
        body {
            margin: 40px;
        }
    }
    
    h1 {
        font-size: 1.5em;
    }
    
    a {
        color: #0085bd !important;
    }
    
    #resultsList h5 {
        margin-top: 10px;
        padding-top: 0px;
    }
    
    #resultsList {
        margin-left: -5px;
        margin-right: -5px;
        overflow-y: auto;
        max-width: cacl(100% - 10px);
        white-space: nowrap;
        background-color: rgba(168, 247, 251, 0.4);
        border: 1px solid #ccc;
        padding-left: 10px;
        padding-right: 35px;
        padding-top: 0px;
        list-style: none;
    }
    
    #resultsList>li {
        margin-bottom: 0.5em;
        font-size: 0.8em;
        font-family: monospace;
    }
    
    #author {
        margin-top: -10px;
    }
    
    footer a {
        text-decoration: none;
    }
    
    footer p {
        text-align: center;
        font-size: 0.8em;
        margin-top: -15px;
        margin-bottom: 5px;
        color: #bbb !important;
    }
    
    .danger {
        color: rgba(255, 0, 0, 1);
        font-weight: bold;
    }
    
    hr {
        border: 0;
        height: 1px;
        margin-top: 25px;
        margin-bottom: 25px;
        background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(40, 40, 40, 0.3), rgba(0, 0, 0, 0));
        background-color: transparent !important;
    }
    
    .summaries {
        padding: 15px;
        margin-left: -5px;
        margin-right: -5px;
    }
    
    #clean-summary {
        background-color: rgba(0, 255, 0, 0.2)
    }
    
    #medium-summary {
        display: none;
        background-color: rgba(255, 255, 0, 0.3);
    }
    
    #dangerous-summary {
        display: none;
        background-color: rgba(255, 0, 0, 0.3);
    }
    
    #all-comments {
        padding-left: 10px;
        margin-top: 10px;
        list-style: inside;
        line-height: 1.3em;
        font-size: 0.8em;
    }
    
    #all-comments>li {
        text-align: left !important;
        padding-left: 0px;
        font-family: 'Courier New', Courier, monospace !important;
        font-weight: bold;
    }
    
    .bad-in-comments {
        color: rgb(175, 0, 0);
    }
    
    .neutral-in-comments {
        color: rgb(0, 0, 175);
    }
    
    .good-in-comments {
        color: rgb(0, 150, 0);
    }
    
    .subtitle {
        font-style: italic;
        font-size: 0.9em;
        color: #666;
        margin-top: -10px;
    }
    
    .summary-note {
        text-align: left;
        color: #666;
        font-size: 0.9em;
    }
    
    #high-level-summary {
        color: #555;
        margin-left: 20px;
        margin-right: 10px;
    }
</style>